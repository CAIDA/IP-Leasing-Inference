# Infer Leased IP Prefixes

This repo contains the analysis code for the IMC 2024 paper [Sublet Your Subnet: Inferring IP Leasing in the Wild](https://www.caida.org/catalog/papers/2024_sublet_your_subnet/sublet_your_subnet.pdf).

## Reference Format

```
@inproceedings{10.1145/3646547.3689010,
  author = {Du, Ben and Fontugne, Romain and Testart, Cecilia and Snoeren, Alex C. and claffy, kc},
  title = {Sublet Your Subnet: Inferring IP Leasing in the Wild},
  year = {2024},
  publisher = {Association for Computing Machinery},
  address = {New York, NY, USA},
  url = {https://doi.org/10.1145/3646547.3689010},
  doi = {10.1145/3646547.3689010},
  booktitle = {Proceedings of the 2024 ACM Internet Measurement Conference},
  numpages = {9},
  location = {Madrid, Spain},
  series = {IMC '24}
}
```

## Results from paper

The 5 files named `leases_[RIR]_20240401.json.gz` contain the 47,318 inferred leased prefixes described in the paper. The prefixes were also annotated with RIR metadata and necesarry information to infer their lease (e.g. BGP origins as depicted in Figure 2 in the paper).

## Curated reference datasets

- The leased prefixes reference dataset (positive labels) needs to be generated by `RIPE.ipynb` and `ARIN.ipynb` with the most up-to-date datasets. The registered brokers are listed in `recognized_brokers_[RIR].txt`. Note: **NOT ALL PREFIXES IN THE GENERATED LIST ARE LEASED**. Some registered brokers also function as ISPs and directly use certain prefixes for their customers. You need to filter such prefixes manually, or utilize the existing code in the notebook to perform the filtering.
- The non-leased prefixes reference dataset is included in the files named `non_lease_[ISP]_pfx.csv`. They are relatively stable compared to leased prefixes.

## Data Requirement

To run the code, you need to download the following CAIDA datasets:

- [CAIDA AS Relationship dataset](https://www.caida.org/catalog/datasets/as-relationships/)
- [CAIDA AS Organizations dataset](https://www.caida.org/catalog/datasets/as-organizations/)
- [CAIDA Routeviews Prefix2AS dataset](https://www.caida.org/catalog/datasets/routeviews-prefix2as/)

and RIR WHOIS database:

- [RIPE](https://ftp.ripe.net/ripe/dbase/) (public)
- [AFRINIC](https://ftp.afrinic.net/dbase/) (public)

- [ARIN](https://www.arin.net/reference/research/bulkwhois/) (need to sign AUP)
- [APNIC](https://www.apnic.net/manage-ip/using-whois/bulk-access/) (need to sign AUP)
- [LACNIC](https://www.lacnic.net/2472/2/lacnic/accessing-bulk-whois) (need to sign AUP)
